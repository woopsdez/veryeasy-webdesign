// LICENSE : MIT
"use strict";

function matchToken(token, expectShape) {
    return Object.keys(expectShape).every(function (key) {
        // Ignore start with _ key
        if (key[0] === "_") {
            return true;
        }
        var actualValue = token[key];
        // support multiple value
        // "pos": ["名詞", "副詞"]
        var expectedValues = Array.isArray(expectShape[key]) ? expectShape[key] : [expectShape[key]];
        return expectedValues.some(function (expectedValue) {
            return actualValue === expectedValue;
        });
    });
}

/**
 * Create matcher function that return { match : true , tokens []} if match the `token`.
 * @param {Object[]} matchedTokens
 * @returns {function(token:Object)}
 */
module.exports = function createTokenMatcher(matchedTokens) {
    var currentTokenPosition = 0;
    var tokenCount = matchedTokens.length;
    var matchTokens = [];
    return function (token) {
        var expectedToken = matchedTokens[currentTokenPosition];
        if (matchToken(token, expectedToken)) {
            matchTokens.push(token);
            currentTokenPosition += 1;
        } else {
            // reset position
            matchTokens.length = 0;
            currentTokenPosition = 0;
        }
        // match all tokens
        if (currentTokenPosition === tokenCount) {
            var tokens = matchTokens.slice();
            // match -> reset
            currentTokenPosition = 0;
            matchTokens.length = 0;
            return {
                match: true,
                tokens: tokens
            };
        }
        return {
            match: false
        };
    };
};
//# sourceMappingURL=morpheme-match.js.map