// LICENSE : MIT
"use strict";

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var tokenize = require("kuromojin").tokenize;
var DefaultOptions = {
    // オノマトペを許可する
    // 制限: オノマトペを判定する方法がないため、同じカタカナの語が連続したものをオノマトペとして扱う
    // 例) カクカク、ドキドキ、ビリビリ
    // https://ja.wikipedia.org/wiki/%E6%93%AC%E5%A3%B0%E8%AA%9E
    allowOnomatopee: true
};

function isOnomatopee(str) {
    return (/^[ァ-ロワヲンー]*$/.test(str)
    );
}

module.exports = function (context) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    var allowOnomatopee = options.allowOnomatopee !== undefined ? options.allowOnomatopee : DefaultOptions.allowOnomatopee;
    var Syntax = context.Syntax,
        RuleError = context.RuleError,
        report = context.report,
        getSource = context.getSource;

    return _defineProperty({}, Syntax.Str, function (node) {
        var text = getSource(node);
        return tokenize(text).then(function (tokens) {
            var prevToken = {};
            var reportIfMatch = function reportIfMatch(prevToken, nextToken) {
                var prevWord = prevToken.surface_form;
                var currentWord = nextToken.surface_form;
                if (prevWord !== currentWord) {
                    return;
                }
                if (allowOnomatopee && isOnomatopee(prevWord) && isOnomatopee(currentWord)) {
                    return;
                }
                var index = Math.max(nextToken.word_position - 1, 0);
                report(node, new RuleError("\"" + currentWord + "\" \u304C\u9023\u7D9A\u3057\u30662\u56DE\u4F7F\u308F\u308C\u3066\u3044\u307E\u3059\u3002", {
                    index: index
                }));
            };
            tokens.forEach(function (token) {
                reportIfMatch(prevToken, token);
                prevToken = token;
            });
        });
    });
};
//# sourceMappingURL=textlint-rule-ja-no-successive-word.js.map